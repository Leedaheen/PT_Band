<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>êµ¬ì¸/êµ¬ì§ ê²Œì‹œíŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 p-4">
<!-- ìƒë‹¨: ì œëª© + ê¸€ì‘ì„± ë²„íŠ¼ -->
<div class="flex justify-between items-center mb-2">
  <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-black whitespace-nowrap">ğŸš€í‰íƒ ì§ì¥ì¸/ì·¨ë¯¸ ë°´ë“œ êµ¬ì¸êµ¬ì§</h1>
  <button onclick="App.openForm()" class="text-white bg-blue-600 hover:bg-blue-700 px-3 py-1 text-sm rounded">+ê¸€ ë“±ë¡</button>
</div>

<!-- ê³µì§€ì‚¬í•­ -->
<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-900 text-sm p-3 rounded mb-2">
  <strong>ì´ ê²Œì‹œíŒì€ í‰íƒì§€ì—­ ë°´ë“œ ì»¤ë®¤ë‹ˆí‹°ìš©ì…ë‹ˆë‹¤. ë§¤ë„ˆë¥¼ ì§€ì¼œì£¼ì„¸ìš”!</strong><br>
  <span class="block mt-1">ëª¨ë“  ë‹‰ë„¤ì„ì€ ì˜¤í”ˆí†¡ ìƒ ë‹‰ë„¤ì„ê³¼ ì¼ì¹˜ì‹œì¼œì£¼ì„¸ìš” <br>
  <strong>ì˜ˆ)</strong> í™ê¸¸ë™/ë³´ì»¬/30 â†’ <strong>í™ê¸¸ë™</strong></span>
</div>

<!-- í•„í„° ë²„íŠ¼ë“¤: êµ¬ë¶„ / ì§€ì—­ -->
<div class="flex justify-between items-center mb-6">
  <div class="flex space-x-1">
    <button onclick="App.filterJobs('ì „ì²´')" class="text-sm bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">ì „ì²´</button>
    <button onclick="App.filterJobs('êµ¬ì¸')" class="text-sm bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">êµ¬ì¸</button>
    <button onclick="App.filterJobs('êµ¬ì§')" class="text-sm bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">êµ¬ì§</button>
    <button onclick="App.filterJobs('ë§¤ì¹­ì™„ë£Œ')" class="text-sm bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">ë§¤ì¹­ì™„ë£Œ</button> <!-- ì¶”ê°€ëœ í•„í„° -->
  </div>
  <select id="regionFilter" class="border p-1 text-sm">
    <option value="ì „ì²´">ì „ì²´</option>
    {% for location in locations %}
    <option value="{{ location }}">{{ location }}</option>
    {% endfor %}
  </select>
</div>

<!-- íŒŒíŠ¸ë³„ í•„í„° -->
<div class="flex space-x-2 mb-6">
  <label class="text-sm">íŒŒíŠ¸ :</label>
  {% for part in parts %}
    <label class="mr-2">
      <input type="checkbox" class="part-filter" value="{{ part }}" onclick="App.filterParts()"> {{ part }}
    </label>
  {% endfor %}
</div>

{% set emoji_map = {
  'ë³´ì»¬(ë‚¨)': 'ğŸ¤', 'ë³´ì»¬(ì—¬)': 'ğŸ¤', 'ë“œëŸ¼': 'ğŸ¥', 'ë² ì´ìŠ¤': 'ğŸ¸', 'ê¸°íƒ€': 'ğŸ¸', 'í‚¤ë³´ë“œ': 'ğŸ¹', 'ê·¸ ì™¸': 'ğŸ”¸'
} %}

{% for job in jobs %}
  <div class="bg-white p-4 mb-6 rounded shadow relative job-item {% if job.pinned %}border-2 border-yellow-400{% endif %}" 
       data-type="{{ job.type }}" 
       data-parts="{{ job.part | join(',') }}"
       data-matched="{{ job.is_matched ? 'true' : 'false' }}"> <!-- ë§¤ì¹­ ìƒíƒœ ì¶”ê°€ -->
    {% if job.pinned %}<span class="absolute top-2 left-2 text-yellow-500 font-bold text-xs">ğŸ“Œ ìƒë‹¨ê³ ì •</span>{% endif %}
    <div class="absolute top-2 right-3 flex gap-2">
      <button class="text-xs text-gray-600 hover:underline" onclick="App.openMatchPopup({{ loop.index0 }})">ë§¤ì¹­ìƒíƒœ ë³€ê²½</button>
    </div>
    <h2 class="text-lg font-semibold mb-1">
      {% if job.type == 'êµ¬ì§' %}
        [ {% for part in job.part %}{{ emoji_map.get(part, '') }}{{ part }}{% if not loop.last %} / {% endif %}{% endfor %} ]
      {% else %}
        [{{ job.team or 'íŒ€ëª… ë¯¸ì •' }}]
      {% endif %}
      <span class="text-sm text-gray-500 ml-1">({{ job.region or 'ê²½ê¸°ë„ > í‰íƒì‹œ' }} / {{ 'ë°ë ¤ê°€ì„¸ìš”!' if job.type == 'êµ¬ì§' else 'ëª¨ì§‘í•©ë‹ˆë‹¤!' }})</span>
    </h2>

    <p class="text-sm text-gray-600 mb-2">
      {% if job.type == 'êµ¬ì¸' %}
        <strong>{% for part in job.part %}{{ emoji_map.get(part, '') }}{{ part }}{% if not loop.last %} / {% endif %}{% endfor %}</strong> ë©¤ë²„ê°€ í•„ìš”í•´ìš”!
      {% else %}
        {{ job.intro or '' }}
      {% endif %}
    </p>

    <div class="expand-content hidden">
      <p class="text-sm text-gray-600"><strong>ì˜¤í”ˆí†¡ ë‹‰ë„¤ì„:</strong> {{ job.nickname or '-' }}</p>
      <p class="text-sm text-gray-600"><strong>ìœ„ì¹˜:</strong> {{ job.location or '-' }}</p>
      <!-- 'ì—°ë ¹ëŒ€' í•­ëª©ì„ 'ë‚˜ì´'ë¡œ ë³€ê²½ -->
      <p class="text-sm text-gray-600"><strong>ë‚˜ì´:</strong> {{ job.age or '-' }}</p>
      {% if job.fee %}<p class="text-sm text-gray-600"><strong>ì›” íšŒë¹„:</strong> {{ job.fee }}</p>{% endif %}
      <p class=text-sm text-blue-600"<strong></strong><br> {{ job.intro or '-' }} </strong></p>
    </div>

    <div class="flex justify-between items-end mt-2">
      <span class="text-xs text-blue-500 cursor-pointer" onclick="App.toggleExpand(this)">&lt;ë” ë³´ê¸°&gt;</span>
      <div class="text-right">
        {% if job.updated_at %}
          <p class="text-xs text-gray-400 mb-1">ğŸ•’ {{ job.updated_at | datetimeformat('%Y-%m-%d %H:%M') }} ìˆ˜ì •</p>
        {% elif job.created_at %}
          <p class="text-xs text-gray-400 mb-1">ğŸ•’ {{ job.created_at | datetimeformat('%Y-%m-%d %H:%M') }} ë“±ë¡</p>
        {% endif %}
        <a href="tel:{{ job.contact }}" onclick="fetch('/click/{{ loop.index0 }}', { method: 'POST' })" class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-1.5 py-[9px] rounded block w-fit mx-auto flex justify-center items-center">
          ì—°ë½ì²˜ í™•ì¸
        </a>
        <p class="text-xs text-gray-400 mt-1">ğŸ‘ {{ job.clicks or 0 }}ëª…ì´ ì—°ë½ì²˜ë¥¼ í™•ì¸í–ˆì–´ìš”</p>
      </div>
    </div>
  </div>
{% endfor %}

<script>
  const App = {
  toggleExpand: function(el) {
    const container = el.closest('.job-item');
    const content = container.querySelector('.expand-content');
    content.classList.toggle('hidden');
    el.innerHTML = content.classList.contains('hidden') ? '&lt;ë” ë³´ê¸°&gt;' : '&lt;ì ‘ê¸°&gt;';
  },

  openForm: function() {
    import('/static/js/form-popup.js').then(module => module.default());
  },

  openMatchPopup: function(index) {
    import('/static/js/match-popup.js')  // match-popup.js íŒŒì¼ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œ
      .then(module => {
        module.default(index);  // match-popup.jsì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ í•¨ìˆ˜ í˜¸ì¶œ
      })
      .catch(err => {
        console.error("match-popup.js ë¡œë”© ì˜¤ë¥˜: ", err);  // ë¡œë“œ ì˜¤ë¥˜ í™•ì¸
      });
  },

  // êµ¬ì¸/êµ¬ì§/ë§¤ì¹­ì™„ë£Œ í•„í„°ë§
  filterJobs: function(type) {
    const jobItems = document.querySelectorAll('.job-item');
    jobItems.forEach(item => {
      const itemType = item.getAttribute('data-type');
      const itemIsMatched = item.getAttribute('data-matched') === 'true'; // ë§¤ì¹­ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
      if (type === 'ë§¤ì¹­ì™„ë£Œ') {
        item.style.display = itemIsMatched ? '' : 'none'; // ë§¤ì¹­ ì™„ë£Œëœ í•­ëª©ë§Œ í‘œì‹œ
      } else {
        item.style.display = (type === 'ì „ì²´' || itemType === type) ? '' : 'none';
      }
    });
  },



  // íŒŒíŠ¸ë³„ í•„í„°ë§
  filterParts: function() {
    const selectedParts = [...document.querySelectorAll('.part-filter:checked')].map(checkbox => checkbox.value);
    const jobItems = document.querySelectorAll('.job-item');

    jobItems.forEach(item => {
      // data-parts ì†ì„±ì—ì„œ íŒŒíŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      const itemParts = item.getAttribute('data-parts').split(',');

      // ì„ íƒëœ íŒŒíŠ¸ê°€ í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ë©´ ê·¸ í•­ëª©ì„ í‘œì‹œ
      const showItem = selectedParts.length === 0 || itemParts.some(part => selectedParts.includes(part));
      item.style.display = showItem ? '' : 'none';
    });
  }
};

</script>
</body>
</html>
